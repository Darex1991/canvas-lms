{"version":3,"sources":["webpack:///./public/javascripts/user_sortable_name.js","webpack:///./app/coffeescripts/util/BackoffPoller.js","webpack:///./public/javascripts/jquery.templateData.js","webpack:///./app/coffeescripts/jquery/fixDialogButtons.js","webpack:///./app/coffeescripts/collections/PaginatedCollection.coffee","webpack:///./public/javascripts/user_utils.js","webpack:///./public/javascripts/profile.js","webpack:///./public/javascripts/communication_channels.js","webpack:///./app/jsx/bundles/profile.js"],"names":["$","$short_name","$name","parents","find","$sortable_name","prior_name","attr","keyup","name","sortable_name","sortable_name_parts","nameParts","jQuery","trim","firstNameFirst","parts","lastNameFirst","short_name","this","BackoffPoller","constructor","url","handler","opts","poll","running","attempts","ajaxJSON","handle","data","xhr","handleErrors","stop","nextPoll","baseInterval","backoffFactor","maxAttempts","initialDelay","start","reset","then","callback","callbacks","push","nextInterval","success","clearTimeout","forEach","parseInt","setTimeout","fn","fillTemplateData","options","length","iterator","andSelf","each","$el","i","replace","id","contentChange","item","except","inArray","dataValues","toString","$found_all","avoid","$found","closest","htmlValues","html","raw","hasClass","removeClass","tagName","toUpperCase","val","str","htmlEscape","e","hrefValues","oldHref","oldRel","oldName","$obj","hasOwnProperty","newHref","replaceTags","encodeURIComponent","orig","text","document","triggerHandler","defaults","getTemplateData","result","textValues","_this","$item","charCodeAt","$elem","getTemplateValue","value","extend","fixDialogButtons","$dialog","$buttons","hide","buttons","map","toArray","button","$button","classes","is","off","on","preventDefault","dialog","prop","form","click","class","_","sortBy","match","capitalize","string","charAt","substring","toLowerCase","nameRegex","linkRegex","pageRegex","perPageRegex","initialize","urls","fetch","clone","loadedAll","exclusionFlag","page","remove","fetchOptions","trigger","dataFilter","_setStateAfterFetch","dfd","Deferred","done","response","next","arguments","loadAll","resolve","abort","error","fail","canFetch","_urlCache","urlIsNotCached","setBottom","firstRequest","atLeastOnePageFetched","setTop","oldUrls","_parsePageLinks","bottom","top","prev","perPage","params","per_page","last","totalPages","linkHeader","split","reduce","links","link","key","Collection","prior_surname","SUFFIXES","surname","given","suffix","given_parts","prior_surname_parts","name_parts","slice","join","test","pop","splice","$edit_settings_link","$profile_table","$update_profile_form","$default_email_id","event","addClass","show","end","focus","select","change","formSubmit","formErrors","required","object_name","property_validations","I18n","t","beforeSubmit","user","templateData","full_name","time_zone","locale","default_email","communication_channel","location","reload","errors","password","pseudonymId","Pseudonym","prototype","normalizeErrors","ENV","PASSWORD_POLICIES","PASSWORD_POLICY","loadingImage","width","open","errorBox","confirmDelete","message","slideUp","slideDown","hover","datetime_field","bind","showIf","$key_row","$focus_row","prevAll","first","nextAll","$to_focus","toggle","purpose","filter","$token","created","datetimeString","created_at","expires","expires_at","used","append","confirm","last_used_at","visible_token","tokenLoaded","token","fragmentChange","hash","type","AvatarWidget","$disable_mfa_link","flashMessage","ready","tabs","channelInputField","css","formatTabs","title","parent","view","resizable","modal","$form","sms_number","useEmail","INTERNATIONAL_SMS_ENABLED","email","processData","address","communication_channel_email","communication_channel_slack","communication_channel_sms_country","communication_channel_sms_email","communication_channel_sms_number","errorMessage","$list","path","$channel","before","image_size","channel","channel_id","select_type","$select","$option","createElement","after","live","currentElement","$elementToFocusOn","manageAfterDeletingAnEmailFocus","toggleClass","confirm_title","$box","user_id","confirmation_limit_reached","code","path_type","pseudonym_id","fillFormData","flashError","formData","default_email_id","$link","hiddenFlags","NEW_USER_TUTORIALS_ENABLED_AT_ACCOUNT","FeatureFlagAdminView","el","collection","fetchAll","container","querySelector","ReactDOM","render","GeneratePairingCode","userId","current_user"],"mappings":"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","file":"profile-c-1c25df8ca1.js","sourcesContent":["/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport $ from 'jquery'\nimport {firstNameFirst, lastNameFirst, nameParts} from './user_utils'\n\n$(function() {\n  const $short_name = $('input[name=\"user[short_name]\"]')\n  // Sometimes user[name] is used for search forms on the same page as edit forms;\n  // so find the name by starting with the short_name\n  const $name = $short_name.parents('form').find('input[name=\"user[name]\"]')\n  const $sortable_name = $('input[name=\"user[sortable_name]\"]')\n  let prior_name = $name.attr('value')\n  $name.keyup(function() {\n    const name = $name.attr('value')\n    const sortable_name = $sortable_name.attr('value')\n    const sortable_name_parts = nameParts(sortable_name)\n    if (\n      jQuery.trim(sortable_name) === '' ||\n      firstNameFirst(sortable_name_parts) === $.trim(prior_name)\n    ) {\n      const parts = nameParts(name, sortable_name_parts[1])\n      $sortable_name.attr('value', lastNameFirst(parts))\n    }\n    const short_name = $short_name.attr('value')\n    if (jQuery.trim(short_name) === '' || short_name === prior_name) {\n      $short_name.attr('value', name)\n    }\n    prior_name = $(this).attr('value')\n  })\n})\n","//\n// Copyright (C) 2011 - present Instructure, Inc.\n//\n// This file is part of Canvas.\n//\n// Canvas is free software: you can redistribute it and/or modify it under\n// the terms of the GNU Affero General Public License as published by the Free\n// Software Foundation, version 3 of the License.\n//\n// Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n// WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n// A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n// details.\n//\n// You should have received a copy of the GNU Affero General Public License along\n// with this program. If not, see <http://www.gnu.org/licenses/>.\n\n// AJAX Backoff poller\n//\n// Repeatedly do a given AJAX call until a condition is met or the max number\n// of attempts has been reached. Each subsequent call will back off further and\n// further.\n//\n// stop/continue/restart behavior is controlled by the return value of the\n// handler function (just return the appropriate string).\n\nimport jQuery from 'jquery'\nimport 'jquery.ajaxJSON'\n\nexport default class BackoffPoller {\n  constructor(url, handler, opts = {}) {\n    this.url = url\n    this.handler = handler\n    this.baseInterval = opts.baseInterval != null ? opts.baseInterval : 1000\n    this.backoffFactor = opts.backoffFactor != null ? opts.backoffFactor : 1.5\n    this.maxAttempts = opts.maxAttempts != null ? opts.maxAttempts : 8\n    this.handleErrors = opts.handleErrors != null ? opts.handleErrors : false\n    this.initialDelay = opts.initialDelay != null ? opts.initialDelay : true\n  }\n\n  start() {\n    if (this.running) {\n      this.reset()\n    } else {\n      this.nextPoll(true)\n    }\n    return this\n  }\n\n  then(callback) {\n    ;(this.callbacks || (this.callbacks = [])).push(callback)\n  }\n\n  reset() {\n    this.nextInterval = this.baseInterval\n    this.attempts = 0\n  }\n\n  stop(success = false) {\n    if (this.running) clearTimeout(this.running)\n    delete this.running\n    if (success && this.callbacks) this.callbacks.forEach(callback => callback())\n    delete this.callbacks\n  }\n\n  poll = () => {\n    this.running = true\n    this.attempts++\n    return jQuery.ajaxJSON(this.url, 'GET', {}, this.handle, (data, xhr) =>\n      this.handleErrors ? this.handle(data, xhr) : this.stop()\n    )\n  }\n\n  handle = (data, xhr) => {\n    switch (this.handler(data, xhr)) {\n      case 'continue':\n        return this.nextPoll()\n      case 'reset':\n        return this.nextPoll(true)\n      case 'stop':\n        return this.stop(true)\n      default:\n        return this.stop()\n    }\n  }\n\n  nextPoll(reset = false) {\n    if (reset) {\n      this.reset()\n      if (!this.initialDelay) return this.poll()\n    } else {\n      this.nextInterval = parseInt(this.nextInterval * this.backoffFactor, 10)\n    }\n    if (this.attempts >= this.maxAttempts) return this.stop()\n\n    return (this.running = setTimeout(this.poll, this.nextInterval))\n  }\n}\n","/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport $ from 'jquery'\nimport htmlEscape from './str/htmlEscape'\nimport './jquery.instructure_misc_helpers' /* replaceTags */\n\n// Fills the selected object(s) with data values as specified.  Plaintext values should be specified in the\n//  data: data used to fill template.\n//  id: set the id attribute of the template object\n//  textValues: a list of strings, which values should be plaintext\n//  htmlValues: a list of strings, which values should be html\n//  hrefValues: List of string.  Searches for all anchor tags in the template\n//    and globally replaces \"{{ value }}\" with data[value].  Useful for adding\n//    new elements asynchronously, when you don't know what their URL will be\n//    until they're created.\n$.fn.fillTemplateData = function(options) {\n  if (this.length && options) {\n    if (options.iterator) {\n      //  todo: replace .andSelf with .addBack when JQuery is upgraded.\n      this.find('*')\n        .andSelf()\n        .each(function() {\n          const $el = $(this)\n          $.each(['name', 'id', 'class'], (i, attr) => {\n            if ($el.attr(attr)) {\n              $el.attr(attr, $el.attr(attr).replace(/-iterator-/, options.iterator))\n            }\n          })\n        })\n    }\n    if (options.id) {\n      this.attr('id', options.id)\n    }\n    let contentChange = false\n    if (options.data) {\n      for (var item in options.data) {\n        if (options.except && $.inArray(item, options.except) != -1) {\n          continue\n        }\n        if (options.data[item] && options.dataValues && $.inArray(item, options.dataValues) != -1) {\n          this.data(item, options.data[item].toString())\n        }\n        const $found_all = this.find('.' + item)\n        var avoid = options.avoid || ''\n        $found_all.each(function() {\n          const $found = $(this)\n          if ($found.length > 0 && $found.closest(avoid).length === 0) {\n            if (typeof options.data[item] === 'undefined' || options.data[item] === null) {\n              options.data[item] = ''\n            }\n            if (options.htmlValues && $.inArray(item, options.htmlValues) != -1) {\n              $found.html($.raw(options.data[item].toString()))\n              if ($found.hasClass('user_content')) {\n                contentChange = true\n                $found.removeClass('enhanced')\n                $found.data('unenhanced_content_html', options.data[item].toString())\n              }\n            } else if ($found[0].tagName.toUpperCase() == 'INPUT') {\n              $found.val(options.data[item])\n            } else {\n              try {\n                const str = options.data[item].toString()\n                $found.html(htmlEscape(str))\n              } catch (e) {}\n            }\n          }\n        })\n      }\n    }\n    if (options.hrefValues && options.data) {\n      this.find('a,span[rel]').each(function() {\n        let $obj = $(this),\n          oldHref,\n          oldRel,\n          oldName\n        for (const i in options.hrefValues) {\n          if (!options.hrefValues.hasOwnProperty(i)) {\n            continue\n          }\n          const name = options.hrefValues[i]\n          if ((oldHref = $obj.attr('href'))) {\n            const newHref = $.replaceTags(oldHref, name, encodeURIComponent(options.data[name]))\n            const orig = $obj.text() === $obj.html() ? $obj.text() : null\n            if (oldHref !== newHref) {\n              $obj.attr('href', newHref)\n              if (orig) {\n                $obj.text(orig)\n              }\n            }\n          }\n          if ((oldRel = $obj.attr('rel'))) {\n            $obj.attr('rel', $.replaceTags(oldRel, name, options.data[name]))\n          }\n          if ((oldName = $obj.attr('name'))) {\n            $obj.attr('name', $.replaceTags(oldName, name, options.data[name]))\n          }\n        }\n      })\n    }\n    if (contentChange) {\n      $(document).triggerHandler('user_content_change')\n    }\n  }\n  return this\n}\n\n$.fn.fillTemplateData.defaults = {htmlValues: null, hrefValues: null}\n\n// Reverse version of fillTemplateData.  Lets you pull out the string versions of values held in divs, spans, etc.\n// Based on the usage of class names within an object to specify an object's sub-parts.\n$.fn.getTemplateData = function(options) {\n  if (!this.length || !options) {\n    return {}\n  }\n  var result = {},\n    item,\n    val\n  if (options.textValues) {\n    const _this = this\n    options.textValues.forEach(item => {\n      const $item = _this.find('.' + item.replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]') + ':first')\n      val = $.trim($item.text())\n      if ($item.html() === '&nbsp;') {\n        val = ''\n      }\n      if (val.length === 1 && val.charCodeAt(0) === 160) {\n        val = ''\n      }\n      result[item] = val\n    })\n  }\n  if (options.dataValues) {\n    for (item in options.dataValues) {\n      var val = this.data(options.dataValues[item])\n      if (val) {\n        result[options.dataValues[item]] = val\n      }\n    }\n  }\n  if (options.htmlValues) {\n    for (item in options.htmlValues) {\n      const $elem = this.find(\n        '.' + options.htmlValues[item].replace(/\\[/g, '\\\\[').replace(/\\]/g, '\\\\]') + ':first'\n      )\n      val = null\n      if ($elem.hasClass('user_content') && $elem.data('unenhanced_content_html')) {\n        val = $elem.data('unenhanced_content_html')\n      } else {\n        val = $.trim($elem.html())\n      }\n      result[options.htmlValues[item]] = val\n    }\n  }\n  return result\n}\n\n$.fn.getTemplateValue = function(value, options) {\n  const opts = $.extend({}, options, {textValues: [value]})\n  return this.getTemplateData(opts)[value]\n}\n","//\n// Copyright (C) 2012 - present Instructure, Inc.\n//\n// This file is part of Canvas.\n//\n// Canvas is free software: you can redistribute it and/or modify it under\n// the terms of the GNU Affero General Public License as published by the Free\n// Software Foundation, version 3 of the License.\n//\n// Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n// WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n// A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n// details.\n//\n// You should have received a copy of the GNU Affero General Public License along\n// with this program. If not, see <http://www.gnu.org/licenses/>.\n\nimport $ from 'jquery'\nimport _ from 'underscore'\nimport preventDefault from '../fn/preventDefault'\nimport 'jqueryui/dialog'\n\n$.fn.fixDialogButtons = function() {\n  return this.each(function() {\n    const $dialog = $(this)\n    const $buttons = $dialog.find('.button-container:last .btn, button[type=submit]')\n    if ($buttons.length) {\n      $dialog.find('.button-container:last, button[type=submit]').hide()\n      let buttons = $.map($buttons.toArray(), button => {\n        const $button = $(button)\n        let classes = $button.attr('class') || ''\n        const id = $button.attr('id')\n\n        // if you add the class 'dialog_closer' to any of the buttons,\n        // clicking it will cause the dialog to close\n        if ($button.is('.dialog_closer')) {\n          $button.off('.fixdialogbuttons')\n          $button.on('click.fixdialogbuttons', preventDefault(() => $dialog.dialog('close')))\n        }\n\n        if ($button.prop('type') === 'submit' && $button[0].form) {\n          classes += ' button_type_submit'\n        }\n\n        return {\n          text: $button.text(),\n          'data-text-while-loading': $button.data('textWhileLoading'),\n          click: () => $button.click(),\n          class: classes,\n          id\n        }\n      })\n      // put the primary button(s) on the far right\n      buttons = _.sortBy(buttons, button => (button.class.match(/btn-primary/) ? 1 : 0))\n      $dialog.dialog('option', 'buttons', buttons)\n    }\n  })\n}\n","#\n# Copyright (C) 2012 - present Instructure, Inc.\n#\n# This file is part of Canvas.\n#\n# Canvas is free software: you can redistribute it and/or modify it under\n# the terms of the GNU Affero General Public License as published by the Free\n# Software Foundation, version 3 of the License.\n#\n# Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n# A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n# details.\n#\n# You should have received a copy of the GNU Affero General Public License along\n# with this program. If not, see <http://www.gnu.org/licenses/>.\n#\n\nimport $ from 'jquery'\nimport Backbone from 'Backbone'\nimport _ from 'underscore'\n\ncapitalize = (string = '') ->\n  string.charAt(0).toUpperCase() + string.substring(1).toLowerCase()\n\nexport default class PaginatedCollection extends Backbone.Collection\n\n  # Matches the name of each link: \"current\", \"next,\" \"prev,\" \"first,\" or \"last.\"\n  nameRegex: /rel=\"([a-z]+)/\n\n  # Matches the full link, e.g. \"/api/v1/accounts/1/users?page=1&per_page=15\"\n  linkRegex: /^<([^>]+)/\n\n  pageRegex: /\\Wpage=(\\d+)/\n\n  perPageRegex: /\\Wper_page=(\\d+)/\n\n  initialize: ->\n    super\n    @urls = {}\n\n  ##\n  # options.page: 'current', 'next', 'prev', 'first', 'last', 'top', 'bottom'\n  fetch: (options = {}) ->\n    options = _.clone(options)\n    @loadedAll = false\n    exclusionFlag = \"fetching#{capitalize options.page}Page\"\n    @[exclusionFlag] = true\n\n    if options.page?\n      options.remove = false unless options.remove?\n      if @urls?[options.page]\n        options.url = @urls[options.page]\n        # API keeps params intact, kill data if we're using a\n        # pagination url to avoid appending in super\n        options.data = ''\n    else\n      # we want the first fetch to reset (since a lot of existing code wants a reset event)\n      options.reset = true unless options.reset?\n\n    if options.fetchOptions?\n      options.data = options.fetchOptions\n\n    @trigger 'beforeFetch', this, options\n    @trigger \"beforeFetch:#{options.page}\", this, options if options.page?\n\n    # have to do this stuff here or else 'reset' and other events are fired\n    # before _setStateAfterFetch has happened, so the state is just barely off\n    xhr = null\n    options.dataFilter = (data) =>\n      @[exclusionFlag] = false\n      @_setStateAfterFetch(xhr, options)\n      data\n\n    dfd = options.dfd || $.Deferred()\n    xhr = super(options).done (response, text, xhr) =>\n      @trigger 'fetch', this, response, options\n      @trigger \"fetch:#{options.page}\", this, response, options if options.page?\n      unless @urls?.next\n        @trigger 'fetched:last', arguments...\n      if @loadAll and @urls.next?\n        setTimeout =>\n          @fetch page: 'next', dfd: dfd # next tick so we can show loading indicator, etc.\n      else\n        dfd.resolve(response, text, xhr)\n    dfd.abort = xhr.abort\n    dfd.success = dfd.done\n    dfd.error = dfd.fail\n    dfd\n\n  canFetch: (page) ->\n    @urls? and @urls[page]?\n\n  _setStateAfterFetch: (xhr, options) =>\n    @_urlCache ?= []\n    urlIsNotCached = options.url not in @_urlCache\n    @_urlCache.push options.url unless urlIsNotCached\n    firstRequest = !@atLeastOnePageFetched\n    setBottom = firstRequest or (options.page in ['next', 'bottom'] and urlIsNotCached)\n    setTop = firstRequest or (options.page in ['prev', 'top'] and urlIsNotCached)\n    oldUrls = @urls\n    @urls = @_parsePageLinks xhr\n\n    if setBottom and @urls.next?\n      @urls.bottom = @urls.next\n    else if !@urls.next\n      delete @urls.bottom\n    else\n      @urls.bottom = oldUrls.bottom\n\n    if setTop and @urls.prev?\n      @urls.top = @urls.prev\n    else if !@urls.prev\n      delete @urls.top\n    else\n      @urls.top = oldUrls.top\n\n    url = @urls.first ? @urls.next\n    if url?\n      perPage = parseInt(url.match(@perPageRegex)[1], 10)\n      ((@options ?= {}).params ?= {}).per_page = perPage\n\n    if @urls.last and match = @urls.last.match(@pageRegex)\n      @totalPages = parseInt(match[1], 10)\n\n    unless @urls?.next\n      @loadedAll = true\n\n    @atLeastOnePageFetched = true\n\n  _parsePageLinks: (xhr) ->\n    linkHeader = xhr.getResponseHeader('link')?.split(',')\n    linkHeader ?= []\n    _.reduce linkHeader, (links, link) =>\n      key = link.match(@nameRegex)[1]\n      val = link.match(@linkRegex)[1]\n      links[key] = val\n      links\n    , {}\n","/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport $ from 'jquery'\n\n// see also User.name_parts in user.rb\nexport function nameParts(name, prior_surname) {\n  const SUFFIXES = /^(Sn?r\\.?|Senior|Jn?r\\.?|Junior|II|III|IV|V|VI|Esq\\.?|Esquire)$/i\n  let surname, given, suffix, given_parts, prior_surname_parts, name_parts\n  if (!name || $.trim(name) === '') {\n    return [null, null, null]\n  }\n  name_parts = $.map(name.split(','), str => $.trim(str))\n  surname = name_parts[0]\n  given = name_parts[1]\n  suffix = name_parts.slice(2).join(', ')\n  if (suffix === '') {\n    suffix = null\n  }\n\n  if (suffix && !SUFFIXES.test(suffix)) {\n    given = `${given} ${suffix}`\n    suffix = null\n  }\n\n  if (typeof given === 'string') {\n    // John Doe, Sr.\n    if (!suffix && SUFFIXES.test(given)) {\n      suffix = given\n      given = surname\n      surname = null\n    }\n  } else {\n    // John Doe\n    given = $.trim(name)\n    surname = null\n  }\n\n  given_parts = given.split(/\\s+/)\n  if (given_parts.length === 1 && given_parts[0] === '') {\n    given_parts = []\n  }\n  // John Doe Sr.\n  if (!suffix && given_parts.length > 1 && SUFFIXES.test(given_parts[given_parts.length - 1])) {\n    suffix = given_parts.pop()\n  }\n  // Use prior information on the last name to try and reconstruct it\n  // This just checks if prior_surname was provided, and if it matches\n  // the trailing words of given_parts\n  if (\n    !surname &&\n    prior_surname &&\n    !/^\\s*$/.test(prior_surname) &&\n    (prior_surname_parts = prior_surname.split(/\\s+/)) &&\n    given_parts.length >= prior_surname_parts.length &&\n    given_parts.slice(given_parts.length - prior_surname_parts.length).join(' ') ===\n      prior_surname_parts.join(' ')\n  ) {\n    surname = given_parts\n      .splice(given_parts.length - prior_surname_parts.length, prior_surname_parts.length)\n      .join(' ')\n  }\n  // Last resort; last name is just the last word given\n  if (!surname && given_parts.length > 1) {\n    surname = given_parts.pop()\n  }\n\n  return [given_parts.length === 0 ? null : given_parts.join(' '), surname, suffix]\n}\n\nexport function lastNameFirst(parts) {\n  const given = $.trim([parts[0], parts[2]].join(' '))\n  return $.trim(parts[1] ? `${parts[1]}, ${given}` : given)\n}\n\nexport function firstNameFirst(parts) {\n  return $.trim(parts.join(' ').replace(/\\s+/, ' '))\n}\n","/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport INST from './INST'\nimport I18n from 'i18n!profile'\nimport $ from 'jquery'\nimport Pseudonym from 'compiled/models/Pseudonym'\nimport AvatarWidget from 'compiled/util/AvatarWidget'\nimport './jquery.ajaxJSON'\nimport './jquery.instructure_date_and_time' /* datetimeString, time_field, datetime_field */\nimport './jquery.instructure_forms' /* formSubmit, formErrors, errorBox */\nimport 'jqueryui/dialog'\nimport 'compiled/jquery/fixDialogButtons'\nimport './jquery.instructure_misc_plugins' /* confirmDelete, fragmentChange, showIf */\nimport './jquery.loadingImg'\nimport './jquery.templateData'\nimport 'jqueryui/sortable'\nimport 'compiled/jquery.rails_flash_notifications'\n\nconst $edit_settings_link = $('.edit_settings_link')\n\nconst $profile_table = $('.profile_table'),\n  $update_profile_form = $('#update_profile_form'),\n  $default_email_id = $('#default_email_id'),\n  profile_pics_url = '/api/v1/users/self/avatars'\n\n$edit_settings_link.click(function(event) {\n  $(this).hide()\n  $profile_table\n    .addClass('editing')\n    .find('.edit_data_row')\n    .show()\n    .end()\n    .find(':focusable:first')\n    .focus()\n    .select()\n  return false\n})\n\n$profile_table.find('.cancel_button').click(event => {\n  $edit_settings_link.show()\n  $profile_table\n    .removeClass('editing')\n    .find('.change_password_row,.edit_data_row,.more_options_row')\n    .hide()\n    .end()\n    .find('#change_password_checkbox')\n    .attr('checked', false)\n  return false\n})\n\n$profile_table\n  .find('#change_password_checkbox')\n  .change(function(event) {\n    if (!$(this).attr('checked')) {\n      $profile_table\n        .find('.change_password_row')\n        .hide()\n        .find(':password')\n        .val('')\n    } else {\n      $(this).addClass('showing')\n      $profile_table\n        .find('.change_password_row')\n        .show()\n        .find('#old_password')\n        .focus()\n        .select()\n    }\n  })\n  .attr('checked', false)\n  .change()\n\n$update_profile_form\n  .attr('method', 'PUT')\n  .formSubmit({\n    formErrors: false,\n    required: $update_profile_form.find('#user_name').length ? ['name'] : [],\n    object_name: 'user',\n    property_validations: {\n      '=default_email_id': function(val, data) {\n        if ($('#default_email_id').length && (!val || val == 'new')) {\n          return I18n.t('please_select_an_option', 'Please select an option')\n        }\n      }\n    },\n    beforeSubmit(data) {},\n    success(data) {\n      const user = data.user\n      const templateData = {\n        short_name: user.short_name,\n        full_name: user.name,\n        sortable_name: user.sortable_name,\n        time_zone: user.time_zone,\n        locale: $(\"#user_locale option[value='\" + user.locale + \"']\").text()\n      }\n      if (templateData.locale != $update_profile_form.find('.locale').text()) {\n        location.reload()\n        return\n      }\n      if ($default_email_id.length > 0) {\n        const default_email = $default_email_id.find('option:selected').text()\n        $('.default_email.display_data').text(default_email)\n      }\n      $('.channel').removeClass('default')\n      $('#channel_' + user.communication_channel.id).addClass('default')\n      $update_profile_form\n        .fillTemplateData({\n          data: templateData\n        })\n        .find('.cancel_button')\n        .click()\n    },\n    error(errors) {\n      if (errors.password) {\n        const pseudonymId = $(this)\n          .find('#profile_pseudonym_id')\n          .val()\n        errors = Pseudonym.prototype.normalizeErrors(\n          errors,\n          ENV.PASSWORD_POLICIES[pseudonymId] || ENV.PASSWORD_POLICY\n        )\n      }\n      $update_profile_form.loadingImage('remove').formErrors(errors)\n      $edit_settings_link.click()\n    }\n  })\n  .find('.more_options_link')\n  .click(() => {\n    $update_profile_form.find('.more_options_link_row').hide()\n    $update_profile_form.find('.more_options_row').show()\n    return false\n  })\n\n$('#default_email_id').change(function() {\n  if ($(this).val() == 'new') {\n    $('.add_email_link:first').click()\n  }\n})\n\n$('#unregistered_services li.service').click(function(event) {\n  event.preventDefault()\n  $('#' + $(this).attr('id') + '_dialog').dialog({\n    width: 350,\n    open() {\n      $(this)\n        .dialog('widget')\n        .find('a')\n        .focus()\n    }\n  })\n})\n$('.create_user_service_form').formSubmit({\n  object_name: 'user_service',\n  beforeSubmit(data) {\n    $(this).loadingImage()\n  },\n  success(data) {\n    $(this)\n      .loadingImage('remove')\n      .parents('.content')\n      .dialog('close')\n    document.location.reload()\n  },\n  error(data) {\n    $(this)\n      .loadingImage('remove')\n      .errorBox(\n        I18n.t(\n          'errors.registration_failed',\n          'Registration failed. Check the user name and password, and try again.'\n        )\n      )\n  }\n})\n$('#unregistered_services li.service .content form .cancel_button').click(function(event) {\n  $(this)\n    .parents('.content')\n    .dialog('close')\n})\n$('#registered_services li.service .delete_service_link').click(function(event) {\n  event.preventDefault()\n  $(this)\n    .parents('li.service')\n    .confirmDelete({\n      message: I18n.t(\n        'confirms.unregister_service',\n        'Are you sure you want to unregister this service?'\n      ),\n      url: $(this).attr('href'),\n      success(data) {\n        $(this).slideUp(function() {\n          $('#unregistered_services')\n            .find('#unregistered_' + $(this).attr('id'))\n            .slideDown()\n        })\n      }\n    })\n})\n$('.service').hover(\n  function() {\n    $(this).addClass('service-hover')\n  },\n  function() {\n    $(this).removeClass('service-hover')\n  }\n)\n$('#show_user_services').change(function() {\n  $.ajaxJSON(\n    $('#update_profile_form').attr('action'),\n    'PUT',\n    {'user[show_user_services]': $(this).prop('checked')},\n    data => {},\n    data => {}\n  )\n})\n$('#disable_inbox').change(function() {\n  $.ajaxJSON(\n    '/profile/toggle_disable_inbox',\n    'POST',\n    {'user[disable_inbox]': $(this).prop('checked')},\n    data => {},\n    data => {}\n  )\n})\n$('.delete_pseudonym_link').click(function(event) {\n  event.preventDefault()\n  $(this)\n    .parents('.pseudonym')\n    .confirmDelete({\n      url: $(this).attr('href'),\n      message: I18n.t('confirms.delete_login', 'Are you sure you want to delete this login?')\n    })\n})\n$('.datetime_field').datetime_field()\n$('.expires_field').bind('change keyup', function() {\n  $(this)\n    .closest('td')\n    .find('.hint')\n    .showIf(!$(this).val())\n})\n$('.delete_key_link').click(function(event) {\n  event.preventDefault()\n  const $key_row = $(this).closest('.access_token')\n  let $focus_row = $key_row.prevAll(':not(.blank)').first()\n  if ($focus_row.length == 0) {\n    $focus_row = $key_row.nextAll(':not(.blank)').first()\n  }\n  const $to_focus =\n    $focus_row.length > 0 ? $('.delete_key_link', $focus_row) : $('.add_access_token_link')\n  $key_row.confirmDelete({\n    url: $(this).attr('rel'),\n    message: I18n.t(\n      'confirms.delete_access_key',\n      'Are you sure you want to delete this access key?'\n    ),\n    success() {\n      $(this).remove()\n      if (!$('.access_token:visible').length) {\n        $('#no_approved_integrations,#access_tokens_holder').toggle()\n      }\n      $to_focus.focus()\n    }\n  })\n})\n$('#add_access_token_dialog .cancel_button').click(() => {\n  $('#add_access_token_dialog').dialog('close')\n})\n$('#access_token_form').formSubmit({\n  object_name: 'access_token',\n  property_validations: {\n    purpose(value) {\n      if (!value || value == '') {\n        return I18n.t('purpose_required', 'Purpose is required')\n      }\n    }\n  },\n  beforeSubmit() {\n    $(this)\n      .find('button')\n      .attr('disabled', true)\n      .filter('.submit_button')\n      .text(I18n.t('buttons.generating_token', 'Generating Token...'))\n  },\n  success(data) {\n    $(this)\n      .find('button')\n      .attr('disabled', false)\n      .filter('.submit_button')\n      .text(I18n.t('buttons.generate_token', 'Generate Token'))\n    $('#add_access_token_dialog').dialog('close')\n    $('#no_approved_integrations').hide()\n    $('#access_tokens_holder').show()\n    const $token = $('.access_token.blank:first')\n      .clone(true)\n      .removeClass('blank')\n    data.created = $.datetimeString(data.created_at) || '--'\n    data.expires = $.datetimeString(data.expires_at) || I18n.t('token_never_expires', 'never')\n    data.used = '--'\n    $token.fillTemplateData({\n      data,\n      hrefValues: ['id']\n    })\n    $token.data('token', data)\n    $('#access_tokens > tbody').append($token.show())\n    $token.find('.show_token_link').click()\n  },\n  error() {\n    $(this)\n      .find('button')\n      .attr('disabled', false)\n      .filter('.submit_button')\n      .text(I18n.t('errors.generating_token_failed', 'Generating Token Failed'))\n  }\n})\n$('#token_details_dialog .regenerate_token').click(function() {\n  const result = confirm(\n    I18n.t(\n      'confirms.regenerate_token',\n      'Are you sure you want to regenerate this token?  Anything using this token will have to be updated.'\n    )\n  )\n  if (!result) {\n    return\n  }\n\n  const $dialog = $('#token_details_dialog')\n  const $token = $dialog.data('token')\n  const url = $dialog.data('token_url')\n  const $button = $(this)\n  $button.text(I18n.t('buttons.regenerating_token', 'Regenerating token...')).attr('disabled', true)\n  $.ajaxJSON(\n    url,\n    'PUT',\n    {'access_token[regenerate]': '1'},\n    data => {\n      data.created = $.datetimeString(data.created_at) || '--'\n      data.expires = $.datetimeString(data.expires_at) || I18n.t('token_never_expires', 'never')\n      data.used = $.datetimeString(data.last_used_at) || '--'\n      data.visible_token = data.visible_token || 'protected'\n      $dialog\n        .fillTemplateData({data})\n        .find('.full_token_warning')\n        .showIf(data.visible_token.length > 10)\n      $token.data('token', data)\n      $button.text(I18n.t('buttons.regenerate_token', 'Regenerate Token')).attr('disabled', false)\n    },\n    () => {\n      $button\n        .text(I18n.t('errors.regenerating_token_failed', 'Regenerating Token Failed'))\n        .attr('disabled', false)\n    }\n  )\n})\n$('.show_token_link').click(function(event) {\n  event.preventDefault()\n  const $dialog = $('#token_details_dialog')\n  const url = $(this).attr('rel')\n  $dialog.dialog({\n    width: 700\n  })\n  const $token = $(this).parents('.access_token')\n  $dialog.data('token', $token)\n  $dialog\n    .find('.loading_message')\n    .show()\n    .end()\n    .find('.results,.error_loading_message')\n    .hide()\n  function tokenLoaded(token) {\n    $dialog.fillTemplateData({data: token})\n    $dialog.data('token_url', url)\n    $dialog\n      .find('.refresh_token')\n      .showIf(token.visible_token && token.visible_token !== 'protected')\n      .find('.regenerate_token')\n      .text(I18n.t('buttons.regenerate_token', 'Regenerate Token'))\n      .attr('disabled', false)\n    $dialog\n      .find('.loading_message,.error_loading_message')\n      .hide()\n      .end()\n      .find('.results')\n      .show()\n      .end()\n      .find('.full_token_warning')\n      .showIf(token.visible_token.length > 10)\n    $dialog.find('.regenerate_token').focus()\n  }\n  const token = $token.data('token')\n  if (token) {\n    tokenLoaded(token)\n  } else {\n    $.ajaxJSON(\n      url,\n      'GET',\n      {},\n      data => {\n        data.created = $.datetimeString(data.created_at) || '--'\n        data.expires = $.datetimeString(data.expires_at) || I18n.t('token_never_expires', 'never')\n        data.used = $.datetimeString(data.last_used_at) || '--'\n        data.visible_token = data.visible_token || 'protected'\n        $token.data('token', data)\n        tokenLoaded(data)\n      },\n      () => {\n        $dialog\n          .find('.error_loading_message')\n          .show()\n          .end()\n          .find('.results,.loading_message')\n          .hide()\n      }\n    )\n  }\n})\n$('.add_access_token_link').click(function(event) {\n  event.preventDefault()\n  $('#access_token_form')\n    .find('button')\n    .attr('disabled', false)\n    .filter('.submit_button')\n    .text(I18n.t('buttons.generate_token', 'Generate Token'))\n  $('#add_access_token_dialog')\n    .find(':input')\n    .val('')\n    .end()\n    .dialog({\n      width: 500,\n      open() {\n        $(this)\n          .closest('.ui-dialog')\n          .focus()\n      }\n    })\n    .fixDialogButtons()\n})\n$(document)\n  .fragmentChange((event, hash) => {\n    let type = hash.substring(1)\n    if (type.match(/^register/)) {\n      type = type.substring(9)\n    }\n    if ($('#unregistered_service_' + type + ':visible').length > 0) {\n      $('#unregistered_service_' + type + ':visible').click()\n    }\n  })\n  .fragmentChange()\n\nnew AvatarWidget('.profile_pic_link')\n\n$('#disable_mfa_link').click(function(event) {\n  const $disable_mfa_link = $(this)\n  $.ajaxJSON($disable_mfa_link.attr('href'), 'DELETE', {}, () => {\n    $.flashMessage(I18n.t('notices.mfa_disabled', 'Multi-factor authentication disabled'))\n    $disable_mfa_link.remove()\n    $('#otp_backup_codes_link').remove()\n  })\n  event.preventDefault()\n})\n","/*\n * Copyright (C) 2012 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport I18n from 'i18n!profile'\nimport $ from 'jquery'\nimport './jquery.ajaxJSON'\nimport './jquery.instructure_forms' /* formSubmit, fillFormData, getFormData, formErrors */\nimport 'jqueryui/dialog'\nimport './jquery.instructure_misc_helpers' /* replaceTags */\nimport './jquery.instructure_misc_plugins' /* confirmDelete, showIf */\nimport './jquery.loadingImg'\nimport 'compiled/jquery.rails_flash_notifications'\nimport './jquery.templateData' /* fillTemplateData, getTemplateData */\nimport 'jqueryui/tabs'\n\n$(document).ready(function() {\n  $('#communication_channels').tabs()\n  $('#communication_channels').bind('tabsshow', function(event) {\n    let channelInputField\n    if ($(this).css('display') != 'none') {\n      // TODO: This is always undefined - where did this come from?\n      const idx = $(this).data('selected.tabs')\n      if (idx == 0) {\n        channelInputField = $('#register_email_address').find(':text:first')\n      } else {\n        channelInputField = $('#register_sms_number').find('input[type=tel]:first')\n      }\n    }\n    formatTabs(channelInputField)\n  })\n  $('.channel_list tr').hover(\n    function() {\n      if ($(this).hasClass('unconfirmed')) {\n        let title = I18n.t(\n          'titles.contact_not_confirmed',\n          'This contact has not been confirmed.  Click the address for more details'\n        )\n        if ($(this).closest('.email_channels').length > 0) {\n          title = I18n.t(\n            'titles.email_not_confirmed',\n            'This email has not been confirmed.  Click the address for more details'\n          )\n        }\n        $(this).attr('title', title)\n        $(this)\n          .find('a.path')\n          .parent()\n          .attr('title', title)\n      }\n    },\n    function() {\n      $(this).attr('title', '')\n      $(this)\n        .find('a.path')\n        .parent()\n        .attr(\n          'title',\n          $(this)\n            .find('a.path')\n            .text()\n        )\n    }\n  )\n  $('.add_email_link,.add_contact_link').click(function(event) {\n    event.preventDefault()\n    let view = 'email'\n    $('#communication_channels')\n      .show()\n      .dialog({\n        title: I18n.t('titles.register_communication', 'Register Communication'),\n        width: 600,\n        resizable: false,\n        modal: true\n      })\n    if ($(this).hasClass('add_contact_link')) {\n      $('#communication_channels').tabs('select', '#register_sms_number')\n      view = 'sms'\n    } else {\n      $('#communication_channels').tabs('select', '#register_email_address')\n    }\n  })\n\n  var formatTabs = function(tabs) {\n    const $form = $(tabs).parents('#register_sms_number')\n    const sms_number = $form\n      .find('.sms_number')\n      .val()\n      .replace(/[^\\d]/g, '')\n\n    const useEmail =\n      !ENV.INTERNATIONAL_SMS_ENABLED || $form.find('.country option:selected').data('useEmail')\n\n    // Don't show the 10-digit warning if we're not expecting a U.S. number\n    $form.find('.should_be_10_digits').showIf(useEmail && sms_number && sms_number.length != 10)\n\n    // Show the \"international text messaging rates may apply\" warning if international SMS is enabled, the user has\n    // selected a country, and that country is not the U.S.\n    $form\n      .find('.intl_rates_may_apply')\n      .showIf(\n        ENV.INTERNATIONAL_SMS_ENABLED &&\n          !useEmail &&\n          $form.find('.country option:selected').val() !== 'undecided'\n      )\n\n    if (useEmail) {\n      $form.find('.sms_email_group').show()\n      let email = $form.find('.carrier').val()\n      $form.find('.sms_email').attr('disabled', email != 'other')\n      if (email == 'other') {\n        return\n      }\n      email = email.replace('#', sms_number)\n      $form.find('.sms_email').val(email)\n    } else {\n      $form.find('.sms_email_group').hide()\n    }\n  }\n\n  $('#register_sms_number .user_selected').bind('change blur keyup focus', function() {\n    formatTabs(this)\n  })\n\n  $('#register_sms_number,#register_email_address,#register_slack_handle').formSubmit({\n    object_name: 'communication_channel',\n    processData(data) {\n      let address\n      let type\n      if (data['communication_channel[type]'] === 'email') {\n        // Email channel\n        type = 'email'\n        address = data.communication_channel_email\n      } else if (data['communication_channel[type]'] === 'slack') {\n        // Slack channel\n        type = 'slack'\n        address = data.communication_channel_slack\n      } else if (\n        ENV.INTERNATIONAL_SMS_ENABLED &&\n        $('#communication_channel_sms_country').val() === 'undecided'\n      ) {\n        // Haven't selected a country yet\n        $(this).formErrors({\n          communication_channel_sms_country: I18n.t('Country or Region is required')\n        })\n        return false\n      } else if (\n        !ENV.INTERNATIONAL_SMS_ENABLED ||\n        $('#communication_channel_sms_country option:selected').data('useEmail')\n      ) {\n        // SMS channel using an email address\n        type = 'sms_email'\n        address = data.communication_channel_sms_email\n      } else {\n        // SMS channel using a phone number\n        type = 'sms_number'\n        address =\n          '+' + data.communication_channel_sms_country + data.communication_channel_sms_number\n      }\n\n      delete data.communication_channel_sms_country\n\n      if (type === 'email' || type === 'sms_email' || type === 'slack') {\n        // Make sure it's a valid email address\n        var match = address.match(\n          /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/\n        )\n        if (!match) {\n          // Not a valid email address. Show a message on the relevant field, then bail.\n          var errorMessage =\n            address === '' ? I18n.t('Email is required') : I18n.t('Email is invalid!')\n          if (type == 'email') {\n            $(this).formErrors({communication_channel_email: errorMessage})\n          } else {\n            $(this).formErrors({communication_channel_sms_email: errorMessage})\n          }\n          return false\n        }\n      } else {\n        // Make sure it's a valid phone number. Validate the phone number they typed instead of the address because\n        // the address will already have the country code prepended, and this will result in our regex failing always\n        // because it's not expecting the leading plus sign (and it can't just be added to the regex because then\n        // we can't detect when they entered a blank phone number). libphonenumber plz\n        var match = data.communication_channel_sms_number.match(/^[0-9]+$/)\n        if (!match) {\n          var errorMessage =\n            address === '' ? I18n.t('Cell Number is required') : I18n.t('Cell Number is invalid!')\n          $(this).formErrors({communication_channel_sms_number: errorMessage})\n          return false\n        }\n      }\n\n      // Don't need these anymore\n      delete data.communication_channel_sms_number\n      delete data.communication_channel_sms_email\n      delete data.communication_channel_slack\n\n      data['communication_channel[address]'] = address\n    },\n    beforeSubmit(data) {\n      let $list = $('.email_channels')\n      if (\n        $(this).attr('id') === 'register_sms_number' ||\n        $(this).attr('id') === 'register_slack_handle'\n      ) {\n        $list = $('.other_channels')\n      }\n      let path = data['communication_channel[address]']\n      $(this).data('email', path)\n      $list.find('.channel .path').each(function() {\n        if ($(this).text() == path) {\n          path = ''\n        }\n      })\n      $list.removeClass('single')\n      let $channel = null\n      if (path) {\n        $channel = $list\n          .find('.channel.blank')\n          .clone(true)\n          .removeClass('blank')\n        if (data['communication_channel[type]'] === 'slack') {\n          $channel.find('#communication_text_type').text('slack')\n        }\n        $channel\n          .find('.path')\n          .attr(\n            'title',\n            I18n.t('titles.unconfirmed_click_to_confirm', 'Unconfirmed.  Click to confirm')\n          )\n        $channel.fillTemplateData({\n          data: {path}\n        })\n        $list.find('.channel.blank').before($channel.show())\n      }\n      if (!path) {\n        return false\n      }\n      $('#communication_channels').dialog('close')\n      $('#communication_channels').hide()\n      $channel.loadingImage({image_size: 'small'})\n      return $channel\n    },\n    success(channel, $channel) {\n      $('#communication_channels').dialog('close')\n      $('#communication_channels').hide()\n      $channel.loadingImage('remove')\n\n      channel.channel_id = channel.id\n      let select_type = 'email_select'\n      if ($(this).attr('id') == 'register_sms_number') {\n        select_type = 'sms_select'\n      }\n      const $select = $('#select_templates .' + select_type)\n      const $option = $(document.createElement('option'))\n      $option.val(channel.id).text(channel.address)\n      $select.find('option:last').before($option)\n      $select.find('option.blank_option').remove()\n      $('.' + select_type).each(function() {\n        let val = $(this).val()\n        if (val == 'new') {\n          val = channel.id\n        }\n        $(this)\n          .after($select.clone(true).val(val))\n          .remove()\n      })\n      $channel.fillTemplateData({\n        data: channel,\n        id: 'channel_' + channel.id,\n        hrefValues: ['user_id', 'pseudonym_id', 'channel_id']\n      })\n      $channel.find('.path').triggerHandler('click')\n    },\n    error(data, $channel) {\n      $channel.loadingImage('remove')\n      $channel.remove()\n    }\n  })\n  $('a.email_address_taken_learn_more').live('click', event => {\n    event.preventDefault()\n  })\n\n  const manageAfterDeletingAnEmailFocus = function(currentElement) {\n    // There may be a better way to do this but I'm not aware of another way. I'm trying to\n    // find the closest prev() or next() sibling\n    let $elementToFocusOn = $(currentElement)\n      .next('.channel:not(.blank)')\n      .last()\n    if (!$elementToFocusOn.length) {\n      $elementToFocusOn = $(currentElement)\n        .prev('.channel:not(.blank)')\n        .last()\n    }\n\n    if ($elementToFocusOn.length) {\n      $elementToFocusOn\n        .find('.email_channel')\n        .first()\n        .focus()\n    } else {\n      $(this)\n        .parents('.channel_list .email_channel')\n        .first()\n        .focus()\n    }\n  }\n\n  $('.channel_list .channel .delete_channel_link').click(function(event) {\n    event.preventDefault()\n    $(this)\n      .parents('.channel')\n      .confirmDelete({\n        url: $(this).attr('href'),\n        success(data) {\n          const $list = $(this).parents('.channel_list')\n          manageAfterDeletingAnEmailFocus(this)\n          $(this).remove()\n          $list.toggleClass('single', $list.find('.channel:visible').length <= 1)\n        }\n      })\n  })\n  $('.channel_list .channel .reset_bounce_count_link').click(function(event) {\n    event.preventDefault()\n    $.ajaxJSON($(this).attr('href'), 'POST', {}, data => {\n      $(this)\n        .parents('.channel')\n        .find('.bouncing-channel')\n        .remove()\n      $(this).remove()\n      $.flashMessage(I18n.t('Bounce count reset!'))\n    })\n  })\n  $('#confirm_communication_channel .cancel_button').click(event => {\n    $('#confirm_communication_channel').dialog('close')\n  })\n  $('.email_channels .channel .path,.other_channels .channel .path').click(function(event) {\n    event.preventDefault()\n    const $channel = $(this).parents('.channel')\n    if ($channel.hasClass('unconfirmed')) {\n      let type = 'email address',\n        confirm_title = I18n.t('titles.confirm_email_address', 'Confirm Email Address')\n      if (\n        $(this)\n          .parents('.channel_list')\n          .hasClass('other_channels')\n      ) {\n        ;(type = 'sms number'), (confirm_title = I18n.t('Confirm Communication Channel'))\n      }\n      let $box = $('#confirm_communication_channel')\n\n      if ($channel.parents('.email_channels').length > 0) {\n        $box = $('#confirm_email_channel')\n      }\n      const data = $channel.getTemplateData({textValues: ['user_id', 'pseudonym_id', 'channel_id']})\n      let path = $(this).text()\n\n      $.ajaxJSON(\n        `/confirmations/${data.user_id}/limit_reached/${data.channel_id}`,\n        'GET',\n        {},\n        data => {\n          if (data.confirmation_limit_reached) {\n            $box.find('.re_send_confirmation_link').css('visibility', 'hidden')\n          } else {\n            $box.find('.re_send_confirmation_link').css('visibility', 'visible')\n          }\n        },\n        _ => {}\n      )\n\n      if (type == 'sms number') {\n        path = path.split('@')[0]\n      }\n      data.code = ''\n\n      $box.fillTemplateData({\n        data: {\n          path,\n          path_type: type,\n          user_id: data.user_id,\n          channel_id: data.channel_id\n        }\n      })\n      $box.find('.status_message').css('visibility', 'hidden')\n      let url = $('.re_send_confirmation_url').attr('href')\n      url = $.replaceTags(url, 'id', data.channel_id)\n      url = $.replaceTags(url, 'pseudonym_id', data.pseudonym_id)\n      url = $.replaceTags(url, 'user_id', data.user_id)\n\n      $box\n        .find('.re_send_confirmation_link')\n        .attr('href', url)\n        .text(I18n.t('links.resend_confirmation', 'Re-Send Confirmation'))\n      $box.fillFormData(data)\n      $box.show().dialog({\n        title: confirm_title,\n        width: 350,\n        open() {\n          $(this)\n            .closest('.ui-dialog')\n            .focus()\n        }\n      })\n    }\n  })\n  $('#confirm_communication_channel').formSubmit({\n    formErrors: false,\n    processData(data) {\n      let url = $(this)\n        .find('.register_channel_link')\n        .attr('href')\n      url = $.replaceTags(url, 'id', data.channel_id)\n      url = $.replaceTags(url, 'code', data.code)\n      $(this).attr('action', url)\n    },\n    beforeSubmit(data) {\n      $(this)\n        .find('.status_message')\n        .text(I18n.t('confirming_contact', 'Confirming...'))\n        .css('visibility', 'visible')\n    },\n    success(data) {\n      $(this)\n        .find('.status_message')\n        .css('visibility', 'hidden')\n      const pseudonym_id = data.communication_channel.pseudonym_id\n      $('#channel_' + data.communication_channel.id).removeClass('unconfirmed')\n      $('.channel.pseudonym_' + pseudonym_id).removeClass('unconfirmed')\n      $('#confirm_communication_channel').dialog('close')\n      $.flashMessage(I18n.t('notices.contact_confirmed', 'Contact successfully confirmed!'))\n    },\n    error(data) {\n      $(this)\n        .find('.status_message')\n        .css('visibility', 'hidden')\n      $.flashError(I18n.t('Confirmation failed.  Please try again.'))\n    }\n  })\n  $('.channel_list .channel .default_link').click(function(event) {\n    event.preventDefault()\n    const channel_id = $(this)\n      .parents('.channel')\n      .getTemplateData({textValues: ['channel_id']}).channel_id\n    const formData = {\n      default_email_id: channel_id\n    }\n    $.ajaxJSON($(this).attr('href'), 'PUT', formData, data => {\n      const channel_id = data.user.communication_channel.id\n      $('.channel.default')\n        .removeClass('default')\n        .find('a.default_link span.screenreader-only.default_label')\n        .remove()\n      $('.channel#channel_' + channel_id)\n        .addClass('default')\n        .find('a.default_link')\n        .append(\n          $('<span class=\"screenreader-only\" />').text(I18n.t('This is the default email address'))\n        )\n      $('.default_email.display_data').text(data.user.communication_channel.path)\n    })\n  })\n  $('.dialog .re_send_confirmation_link').click(function(event) {\n    event.preventDefault()\n    const $link = $(this)\n    $link.text(I18n.t('links.resending_confirmation', 'Re-Sending...'))\n    $.ajaxJSON(\n      $link.attr('href'),\n      'POST',\n      {},\n      data => {\n        $link.text(I18n.t('links.resent_confirmation', 'Done! Message may take a few minutes.'))\n      },\n      data => {\n        $link.text(I18n.t('links.resend_confirmation_failed', 'Request failed. Try again.'))\n      }\n    )\n  })\n  $('#communication_channels .cancel_button').click(event => {\n    $('#communication_channels').dialog('close')\n  })\n  $('#confirm_email_channel .cancel_button').click(() => {\n    $('#confirm_email_channel').dialog('close')\n  })\n})\n","/*\n * Copyright (C) 2011 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport FeatureFlagAdminView from 'compiled/views/feature_flags/FeatureFlagAdminView'\nimport 'compiled/util/BackoffPoller'\nimport 'profile'\nimport 'user_sortable_name'\nimport 'communication_channels'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport GeneratePairingCode from '../profiles/GeneratePairingCode'\nimport ready from '@instructure/ready'\n\nready(() => {\n  const hiddenFlags = []\n  if (!ENV.NEW_USER_TUTORIALS_ENABLED_AT_ACCOUNT) {\n    hiddenFlags.push('new_user_tutorial_on_off')\n  }\n\n  const view = new FeatureFlagAdminView({el: '.feature-flag-wrapper', hiddenFlags})\n  view.collection.fetchAll()\n\n  const container = document.querySelector('#pairing-code')\n  if (container) {\n    ReactDOM.render(<GeneratePairingCode userId={ENV.current_user.id} />, container)\n  }\n})\n"],"sourceRoot":""}
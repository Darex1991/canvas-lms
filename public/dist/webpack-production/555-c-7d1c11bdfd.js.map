{"version":3,"sources":["webpack:///./app/coffeescripts/jquery/serializeForm.js","webpack:///./app/coffeescripts/jquery/fixDialogButtons.js","webpack:///./app/coffeescripts/views/ValidatedMixin.coffee","webpack:///./public/javascripts/jquery.toJSON.js"],"names":["rselectTextarea","rCRLF","rinput","elements","this","$","makeArray","els","find","length","isSerializable","name","disabled","checked","test","nodeName","type","resultFor","value","replace","getValue","$input","hasClass","val","data","send","isArray","map","fn","serializeForm","filter","get","fixDialogButtons","each","$dialog","$buttons","hide","buttons","toArray","button","$button","classes","attr","id","is","off","on","preventDefault","dialog","prop","form","text","click","class","_","sortBy","match","fieldSelectors","findSiblingTinymce","$el","siblings","findField","field","useGlobalSelector","selector","showErrors","errors","element","fieldName","html","message","join","attachErrorDescription","$errorBox","errorDescriptionField","findOrCreateDescriptionField","raw","insertBefore","description","originalDescriptionIds","getExistingDescriptionIds","descriptionIds","idArray","split","without","patterns","validate","key","push","fixed","named","build","base","toJSON","json","push_counters","push_counter","i","k","keys","merge","reverse_key","pop","RegExp","extend"],"mappings":"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","file":"555-c-7d1c11bdfd.js","sourcesContent":["//\n// Copyright (C) 2012 - present Instructure, Inc.\n//\n// This file is part of Canvas.\n//\n// Canvas is free software: you can redistribute it and/or modify it under\n// the terms of the GNU Affero General Public License as published by the Free\n// Software Foundation, version 3 of the License.\n//\n// Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n// WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n// A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n// details.\n//\n// You should have received a copy of the GNU Affero General Public License along\n// with this program. If not, see <http://www.gnu.org/licenses/>.\n\nimport $ from 'jquery'\nimport {send} from 'jsx/shared/rce/RceCommandShim'\n\nconst rselectTextarea = /^(?:select|textarea)/i\nconst rCRLF = /\\r?\\n/g\nconst rinput = /^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week|file)$/i\n// radio / checkbox are not included, since they are handled by the @checked check\n\nfunction elements() {\n  if (this.elements) {\n    return $.makeArray(this.elements)\n  } else {\n    const els = $(this).find(':input')\n    if (els.length) {\n      return els\n    } else {\n      return this\n    }\n  }\n}\n\nfunction isSerializable() {\n  return (\n    this.name &&\n    !this.disabled &&\n    (this.checked || rselectTextarea.test(this.nodeName) || rinput.test(this.type))\n  )\n}\n\nfunction resultFor(name, value) {\n  if (typeof value === 'string') value = value.replace(rCRLF, '\\r\\n')\n  return {name, value}\n}\n\nfunction getValue() {\n  const $input = $(this)\n  const value = (() => {\n    if (this.type === 'file') {\n      if ($input.val()) return this\n    } else if ($input.hasClass('datetime_field_enabled')) {\n      // datepicker doesn't clear the data date attribute when a date is deleted\n      if ($input.val() === '') {\n        return null\n      } else {\n        return $input.data('date') || null\n      }\n    } else if ($input.data('rich_text')) {\n      return send($input, 'get_code', false)\n    } else {\n      return $input.val()\n    }\n  })()\n\n  if ($.isArray(value)) {\n    return value.map(val => resultFor(this.name, val))\n  } else {\n    return resultFor(this.name, value)\n  }\n}\n\n// #\n// identical to $.fn.serializeArray, except:\n// 1. it works on non-forms (see elements)\n// 2. it handles file, date picker and tinymce inputs (see getValue)\nexport default $.fn.serializeForm = function() {\n  return this.map(elements)\n    .filter(isSerializable)\n    .map(getValue)\n    .get()\n}\n","//\n// Copyright (C) 2012 - present Instructure, Inc.\n//\n// This file is part of Canvas.\n//\n// Canvas is free software: you can redistribute it and/or modify it under\n// the terms of the GNU Affero General Public License as published by the Free\n// Software Foundation, version 3 of the License.\n//\n// Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n// WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n// A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n// details.\n//\n// You should have received a copy of the GNU Affero General Public License along\n// with this program. If not, see <http://www.gnu.org/licenses/>.\n\nimport $ from 'jquery'\nimport _ from 'underscore'\nimport preventDefault from '../fn/preventDefault'\nimport 'jqueryui/dialog'\n\n$.fn.fixDialogButtons = function() {\n  return this.each(function() {\n    const $dialog = $(this)\n    const $buttons = $dialog.find('.button-container:last .btn, button[type=submit]')\n    if ($buttons.length) {\n      $dialog.find('.button-container:last, button[type=submit]').hide()\n      let buttons = $.map($buttons.toArray(), button => {\n        const $button = $(button)\n        let classes = $button.attr('class') || ''\n        const id = $button.attr('id')\n\n        // if you add the class 'dialog_closer' to any of the buttons,\n        // clicking it will cause the dialog to close\n        if ($button.is('.dialog_closer')) {\n          $button.off('.fixdialogbuttons')\n          $button.on('click.fixdialogbuttons', preventDefault(() => $dialog.dialog('close')))\n        }\n\n        if ($button.prop('type') === 'submit' && $button[0].form) {\n          classes += ' button_type_submit'\n        }\n\n        return {\n          text: $button.text(),\n          'data-text-while-loading': $button.data('textWhileLoading'),\n          click: () => $button.click(),\n          class: classes,\n          id\n        }\n      })\n      // put the primary button(s) on the far right\n      buttons = _.sortBy(buttons, button => (button.class.match(/btn-primary/) ? 1 : 0))\n      $dialog.dialog('option', 'buttons', buttons)\n    }\n  })\n}\n","#\n# Copyright (C) 2013 - present Instructure, Inc.\n#\n# This file is part of Canvas.\n#\n# Canvas is free software: you can redistribute it and/or modify it under\n# the terms of the GNU Affero General Public License as published by the Free\n# Software Foundation, version 3 of the License.\n#\n# Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n# A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n# details.\n#\n# You should have received a copy of the GNU Affero General Public License along\n# with this program. If not, see <http://www.gnu.org/licenses/>.\n\nimport $ from 'jquery'\nimport _ from 'underscore'\nimport htmlEscape from 'str/htmlEscape'\nimport 'jquery.toJSON'\nimport 'jquery.disableWhileLoading'\nimport 'jquery.instructure_forms'\nimport 'jquery.instructure_misc_helpers'\n\nexport default ValidatedMixin =\n\n  ##\n  # Errors are displayed relative to the field to which they belong. If\n  # the key of the error in the response doesn't match the name attribute\n  # of the form input element, configure a selector here.\n  #\n  # For example, given a form field like this:\n  #\n  #   <input name=\"user[first_name]\">\n  #\n  # and an error response like this:\n  #\n  #   {errors: { first_name: {...} }}\n  #\n  # you would do this:\n  #\n  #   fieldSelectors:\n  #     first_name: '[name=user[first_name]]'\n  fieldSelectors: null\n\n  ##\n  # For a given dom element, retrieve the sibling tinymce wrapper.\n  #\n  # @param {jQuery Object} the textarea for whom we wish to get the\n  #   related tinymce editor area\n  # @return {jQuery Object} the relevant div that wraps the tinymce\n  #   iframe related to this textarea\n  findSiblingTinymce: ($el)->\n    $el.siblings('.mce-tinymce').find(\".mce-edit-area\")\n\n  findField: (field, useGlobalSelector=false) ->\n    selector = @fieldSelectors?[field] or \"[name='#{field}']\"\n    if useGlobalSelector\n      $el = $(selector)\n    else\n      $el = @$(selector)\n\n    if $el.data('rich_text')\n      $el = @findSiblingTinymce($el)\n    $el\n\n  ##\n  # Needs an errors object that looks like this:\n  #\n  #   {\n  #     <field1>: [errors],\n  #     <field2>: [errors]\n  #   }\n  #\n  # For example:\n  #\n  #   {\n  #     first_name: [\n  #       {\n  #         type: 'required'\n  #         message: 'First name is required'\n  #       },\n  #       {\n  #         type: 'no_numbers',\n  #         message: \"First name can't contain numbers\"\n  #       }\n  #     ]\n  #   }\n  #\n  # If globalSelector is true, it will look for this element everywhere\n  # in the DOM instead of only `this` children elements. This is particularly\n  # useful for some modals\n  showErrors: (errors, useGlobalSelector=false) ->\n    for fieldName, field of errors\n      $input = field.element || @findField(fieldName, useGlobalSelector)\n      html = field.message || (htmlEscape(@translations?[message] or message) for {message} in field).join('</p><p>')\n      $input.errorBox($.raw(\"#{html}\"))?.css(\"z-index\", \"1100\")?.attr('role', 'alert')\n      @attachErrorDescription($input, html)\n      field.$input = $input\n      field.$errorBox = $input.data 'associated_error_box'\n\n  attachErrorDescription: ($input, message) ->\n    errorDescriptionField = @findOrCreateDescriptionField($input)\n    errorDescriptionField[\"description\"].text($.raw(\"#{message}\"))\n    $input.attr('aria-describedby',\n      errorDescriptionField[\"description\"].attr('id') + \" \" +\n      errorDescriptionField[\"originalDescriptionIds\"]\n    )\n\n  findOrCreateDescriptionField: ($input) ->\n    id = $input.attr('id')\n    unless $(\"##{id}_sr_description\").length > 0\n      $('<div>').attr({\n        id: \"#{id}_sr_description\"\n        class: \"screenreader-only\"\n      }).insertBefore($input)\n    description = $(\"##{id}_sr_description\")\n    originalDescriptionIds = @getExistingDescriptionIds($input, id)\n    {description: description, originalDescriptionIds: originalDescriptionIds}\n\n  getExistingDescriptionIds: ($input, id) ->\n    descriptionIds = $input.attr('aria-describedby')\n    idArray = if descriptionIds then descriptionIds.split(\" \") else []\n    _.without(idArray,\"#{id}_sr_description\")\n","/*\n * Copyright (C) 2012 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport $ from 'jquery'\nimport 'compiled/jquery/serializeForm'\n\nconst patterns = {\n  validate: /^[a-zA-Z][a-zA-Z0-9_-]*(?:\\[(?:\\d*|[a-zA-Z0-9_-]+)\\])*$/,\n  key: /[a-zA-Z0-9_-]+|(?=\\[\\])/g,\n  push: /^$/,\n  fixed: /^\\d+$/,\n  named: /^[a-zA-Z0-9_-]+$/\n}\n\nconst build = function(base, key, value) {\n  base[key] = value\n  return base\n}\n\n$.fn.toJSON = function() {\n  let json = {},\n    push_counters = {}\n\n  const push_counter = function(key, i) {\n    if (push_counters[key] === undefined) {\n      push_counters[key] = 0\n    }\n    if (i === undefined) {\n      return push_counters[key]++\n    } else if (i !== undefined && i > push_counters[key]) {\n      return (push_counters[key] = ++i)\n    }\n  }\n\n  $.each($(this).serializeForm(), function() {\n    // skip invalid keys\n    if (!patterns.validate.test(this.name)) {\n      return\n    }\n\n    let k,\n      keys = this.name.match(patterns.key),\n      merge = this.value,\n      reverse_key = this.name\n\n    while ((k = keys.pop()) !== undefined) {\n      // adjust reverse_key\n      reverse_key = reverse_key.replace(new RegExp('\\\\[' + k + '\\\\]$'), '')\n\n      // push\n      if (k.match(patterns.push)) {\n        merge = build([], push_counter(reverse_key), merge)\n      }\n\n      // fixed\n      else if (k.match(patterns.fixed)) {\n        push_counter(reverse_key, k)\n        merge = build([], k, merge)\n      }\n\n      // named\n      else if (k.match(patterns.named)) {\n        merge = build({}, k, merge)\n      }\n    }\n\n    json = $.extend(true, json, merge)\n  })\n\n  return json\n}\n"],"sourceRoot":""}
{"version":3,"sources":["webpack:///./public/javascripts/tinymce_plugins/instructure_equella/initializeEquella.js"],"names":["ed","$box","$","url","attr","action","trim","text","callback_url","cancel_url","alert","frameHeight","Math","max","min","window","height","length","boxHtml","teaserAndIframeHtml","raw","hide","html","appendTo","dialog","autoOpen","width","resizable","resizeStart","this","find","each","css","offsetWidth","offsetHeight","position","opacity","zIndex","offset","resizeStop","remove","resize","add","close","title","bind","event","data","selection","getContent","execCommand","name","href","class","$link","teaserHtml","show","full_url","encodeURIComponent"],"mappings":";AAAA;AAAA;AAAA;AAqBe,mBAASA,GACtB,IAAIC,EAAOC,IAAE;AACb,MAAMC,EAAMD,IAAE,yBAAyBE,KAAK,QACtCC,EAASH,IAAEI,KAAKJ,IAAE,mBAAmBK,QAAU,KAAO,cACtDC,EAAeN,IAAE,yBAAyBE,KAAK,QAC/CK,EAAaP,IAAE,uBAAuBE,KAAK;AACjD,IAAKD,IAAQK,IAAiBC,EAI5B,YAHAC,MACE;AAIJ,MAAMC,EAAcC,KAAKC,IAAID,KAAKE,IAAIZ,IAAEa,QAAQC,SAAW,IAAK,KAAM;AACtE,IAAKf,EAAKgB,OAAQ,CAChB,MAAMC,EAAU,qEACVC,EACJjB,IAAEkB,IACA,wFAEFlB,IAAEkB,IACA,iHAEFlB,IAAEkB,IAAIT,GACNT,IAAEkB,IAAI;AACRnB,EAAOC,IAAEgB,GACNG,OACAC,KAAKH,GACLI,SAAS,QACTC,OAAO,CACNC,UAAU,EACVC,MAAO,OACPC,WAAW,EACXC,cACE1B,IAAE2B,MACCC,KAAK,UACLC,MAAK,WACJ7B,IAAE,8EACC8B,IAAI,CACHN,MAAOG,KAAKI,YAAc,KAC1BjB,OAAQa,KAAKK,aAAe,KAC5BC,SAAU,WACVC,QAAS,QACTC,OAAQ,MAETL,IAAI9B,IAAE2B,MAAMS,UACZf,SAAS,YAGlBgB,aACErC,IAAE,iCAAiCsC,UAErCC,SACEvC,IAAE2B,MACCC,KAAK,UACLY,IAAI,iCACJ1B,OAAOd,IAAE2B,MAAMb,UACfU,MAAMxB,IAAE2B,MAAMH,UAEnBiB,QACE1C,EAAK6B,KAAK,UAAU1B,KAAK,MAAO,gBAElCwC,MAAO,+BAERC,KAAK,gBAAiB,CAACC,EAAOC,KACP9C,EAAK8C,KAAK;AAEhC,GADwB/C,EAAGgD,UAAUC,aAGnCjD,EAAGkD,YAAY,iBAAiB,EAAO,CACrCN,MAAOG,EAAKI,KACZC,KAAML,EAAK5C,IACXkD,MAAO;IAEJ,CAEL,MAAMC,EAAQpD,IAAE;AAChBoD,EACGxB,KAAK,KACL1B,KAAK,QAAS2C,EAAKI,MACnB/C,KAAK,OAAQ2C,EAAK5C,KAClBC,KAAK,QAAS,wBACdG,KAAKwC,EAAKI,MACbnD,EAAGkD,YAAY,oBAAoB,EAAOI,EAAMhC,QAElDpB,IAAE,mBAAmBsB,OAAO,WAGlC,MAAM+B,EAAarD,IAAE,mBAAmBoB;AACxCrB,EAAK6B,KAAK,WAAWT,OACjBkC,GACFtD,EACG6B,KAAK,WACLR,KAAKiC,GACLC;AAEL,IAAIC,EAAWtD;AACfsD,EAAWA,EAAW,uCAAyCpD,EAC/DoD,EAAWA,EAAW,cAAgBC,mBAAmBlD,GACzDiD,EAAWA,EAAW,cAAgBC,mBAAmBjD,GACzDR,EAAK8C,KAAK,SAAU/C,GACpBC,EAAKuB,OAAO,SAASA,OAAO,QAC5BvB,EAAK6B,KAAK,UAAU1B,KAAK,MAAOqD","file":"635-c-50fdc99e78.js","sourcesContent":["/*\n * Copyright (C) 2015 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport $ from 'jquery'\nimport 'jqueryui/dialog'\n\nexport default function(ed) {\n  let $box = $('#equella_dialog')\n  const url = $('#equella_endpoint_url').attr('href')\n  const action = $.trim($('#equella_action').text() || '') || 'selectOrAdd'\n  const callback_url = $('#equella_callback_url').attr('href')\n  const cancel_url = $('#equella_cancel_url').attr('href')\n  if (!url || !callback_url || !cancel_url) {\n    alert(\n      'Equella is not properly configured for this account, please notify your system administrator.'\n    )\n    return\n  }\n  const frameHeight = Math.max(Math.min($(window).height() - 100, 550), 100)\n  if (!$box.length) {\n    const boxHtml = '<div id=\"equella_dialog\" style=\"padding: 0; overflow-y: hidden;\"/>'\n    const teaserAndIframeHtml =\n      $.raw(\n        \"<div class='teaser' style='width: 800px; margin-bottom: 10px; display: none;'></div>\"\n      ) +\n      $.raw(\n        \"<iframe style='background: url(/images/ajax-loader-medium-444.gif) no-repeat left top; width: 800px; height: \"\n      ) +\n      $.raw(frameHeight) +\n      $.raw(\"px; border: 0;' src='about:blank' borderstyle='0'/>\")\n    $box = $(boxHtml)\n      .hide()\n      .html(teaserAndIframeHtml)\n      .appendTo('body')\n      .dialog({\n        autoOpen: false,\n        width: 'auto',\n        resizable: true,\n        resizeStart() {\n          $(this)\n            .find('iframe')\n            .each(function() {\n              $('<div class=\"fix_for_resizing_over_iframe\" style=\"background: #fff;\"></div>')\n                .css({\n                  width: this.offsetWidth + 'px',\n                  height: this.offsetHeight + 'px',\n                  position: 'absolute',\n                  opacity: '0.001',\n                  zIndex: 10000000\n                })\n                .css($(this).offset())\n                .appendTo('body')\n            })\n        },\n        resizeStop() {\n          $('.fix_for_resizing_over_iframe').remove()\n        },\n        resize() {\n          $(this)\n            .find('iframe')\n            .add('.fix_for_resizing_over_iframe')\n            .height($(this).height())\n            .width($(this).width())\n        },\n        close() {\n          $box.find('iframe').attr('src', 'about:blank')\n        },\n        title: 'Embed content from Equella'\n      })\n      .bind('equella_ready', (event, data) => {\n        const clickedEditor = $box.data('editor') || ed\n        const selectedContent = ed.selection.getContent()\n        if (selectedContent) {\n          // selected content\n          ed.execCommand('mceInsertLink', false, {\n            title: data.name,\n            href: data.url,\n            class: 'equella_content_link'\n          })\n        } else {\n          // no selected content\n          const $link = $('<div><a/></div>')\n          $link\n            .find('a')\n            .attr('title', data.name)\n            .attr('href', data.url)\n            .attr('class', 'equella_content_link')\n            .text(data.name)\n          ed.execCommand('mceInsertContent', false, $link.html())\n        }\n        $('#equella_dialog').dialog('close')\n      })\n  }\n  const teaserHtml = $('#equella_teaser').html()\n  $box.find('.teaser').hide()\n  if (teaserHtml) {\n    $box\n      .find('.teaser')\n      .html(teaserHtml)\n      .show()\n  }\n  let full_url = url\n  full_url = full_url + '?method=lms&returnprefix=eq_&action=' + action\n  full_url = full_url + '&returnurl=' + encodeURIComponent(callback_url)\n  full_url = full_url + '&cancelurl=' + encodeURIComponent(cancel_url)\n  $box.data('editor', ed)\n  $box.dialog('close').dialog('open')\n  $box.find('iframe').attr('src', full_url)\n}\n"],"sourceRoot":""}